var console,
    stat,
    myMap,
    lineSymbol,
    initLat = 38.823,
    initLng = -99.712,
    zoom = 4,
    initZoom = 4,
    markerArray = [],
    lineArray = [],
    tLimit = 10,
    speed = 2,
    isAuto = true,
    tempLat = 0,
    tempLng = 0;


console = document.getElementById("console-text");
stat = document.getElementById("stat-text");

function addText(box,text) {
    box.value += text;
    //var txt = document.createTextNode(text);
    //box.appendChild(txt);
    stat.scrollTop = stat.scrollHeight; // scoll down when adding text
    // check for commands
    
    
    
}

function myLink(){

    for(i = 0; i < markerArray.length-1; i++){

    var lineSymbol = new google.maps.Marker({
        path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
    scale: 2,
    strokeOpacity: 1.0,
    strokeColor: ranColor()
    });

      var line = new google.maps.Polyline({
        strokeColor: 'yellow',
        strokeOpacity: 0.2,
        path: [markerArray[i].getPosition(), markerArray[markerArray.length - 1].getPosition()],
        //path: [{lat: 22.291, lng: 153.027}, {lat: 18.291, lng: 153.027}],
        icons: [{
          icon: lineSymbol,
          offset: '100%'
        }],
        map: myMap
      });

  
            lineArray.push(line);

      animateCircle(line);
    }


 


}

function ranColor(){
var colors = ['purple', 'white'];

return colors[Math.floor(Math.random() * colors.length)];

}

//sat
function initMap(addMarker) {
  // Create a map object and specify the DOM element for display.

    myMap = new google.maps.Map(document.getElementById('map'), {
    center: {lat: initLat, lng: initLng},
    //mapTypeId: google.maps.MapTypeId.SATELLITE,
    mapTypeId: google.maps.MapTypeId.HYBRID,

    scrollwheel: false,
    zoom: zoom
    });
  

  
    google.maps.event.addListener(myMap, "click", myAdd);
    
    //geocoder = new google.maps.Geocoder();

         
}

  
function myAdd(event){
  var t = event.latLng.lat();
  var g = event.latLng.lng();
    typeAdd(t,g,false);

}



function typeAdd(t,g,zoom){
  var lat = t;
        var lng = g;
        // populate yor box/field with lat, lng
        //alert("Lat=" + lat + "; Lng=" + lng);
        if(markerArray.length < tLimit ){
            var n =  "Target",
                c = "red",
                s = 8;
            if(markerArray.length == 0){
            n = "Origin";
            c = "blue";
            s = 12;
            }
            addText(stat,"\n" + n + " " + markerArray.length + " location:\n  Lat: " + lat + "\n  Lng: " + lng + "\n");
            //tArray.push(new Target(lat, lng));
            
            var marker = new google.maps.Marker({
            position: {lat: lat, lng: lng},
            icon: {
            path: google.maps.SymbolPath.CIRCLE,
            strokeColor: c,
            strokeOpacity: 0.5,
            scale: s
            },
            map: myMap
            });
            markerArray.push(marker);
            myLink();
        }
        else{
        //that's enough targets
        
        } 
        if(zoom){
            goTo(markerArray.length -1);
        }

}
  

// at fixed intervals.
function animateCircle(line) {
    var count = 0;
    window.setInterval(function() {
      count = (count + speed) % 200;

      var icons = line.get('icons');
      icons[0].offset = (count / 2) + '%';
      line.set('icons', icons);
  }, 2);
}


// Deletes all markers in the array by removing references to them.
function clearMarkers() {
    for (var i = 0; i < markerArray.length; i++) {
        markerArray[i].setMap(null);
    }
    for (var i = 0; i < lineArray.length; i++) {
        lineArray[i].setMap(null);
    }
    
    markerArray= [];
}

function goTo(m){
    myMap.panTo(markerArray[m].position);
    myMap.setZoom(6);
}

var typeText = "",
    typeCount = 0;
    
function myCommand(str){

    try {
    var par = str.split(" "),
    num = par.length;
    
    c = par[0];
    if(c == "clear"){
        console.value = "";
    
    }
    else if(c == "map"){
        if(num ==1){
            myMap.panTo({lat: initLat, lng: initLng});
            myMap.setZoom(initZoom);
        }
        else if(par[1] == "reset"){
            clearMarkers();
            myMap.setZoom(initZoom);
            zoom = initZoom;
            addText(stat,"\n//====================//\n");
        }
        else if(par[1] == "in"){
            myMap.setZoom(++zoom);
        }
        else if(par[1] == "out"){
            myMap.setZoom(--zoom);
        }
        else if(par[1] == "set"){
            typeAdd(parseFloat(par[2]), parseFloat(par[3]), true);

        }
        else{
            goTo(parseInt(par[1], 10));
            zoom = 6;
        }
    
    }
    else if(c == "encode"){
        
        typeText = str.substring(str.indexOf("'")+1,str.lastIndexOf("'"));
        myType();
        //text.value = temp;
        //tChange();
    }
        
    }
    catch(err) {
       //output error 
       alert(err.message);
    }
    
        //alert( "*" +lastLine+"*");
}


    
function myType(){
    if(typeCount < typeText.length){
        text.value += typeText[typeCount];
        tChange();
        typeCount += 1;
        setTimeout('myType()',200);
    }
}


var autoString = "//Operation: Downfall\n//Objective: DDoS Skynet servers\nmap out\nmap set 36.138 -115.125\n\nssh csmojo.com\nUsername: a46+1\nPassword: ************\n\nsetEventListener('onFailure', SELF_DESTRUCT)\nattackAutoOnMap = true\nmap set 38.823 -99.712\nmap set 34.073 -118.837\nmap set 48.681 -73.998\nmap 1\nmap 0\nmap set 37.718 -122.38\nmap set -21.166 148.919\nencode 'This is your last chance. After this, there is no turning back.'\nmap set 31.178 121.498\nmap out\nmap set -11.178 -62.226\nmap out\ncluster -t -r\nmap\nmap out\nhello\nmap reset\nclear\n";
var count = 0;

console.onkeydown = function keyed(e){
    e = e || window.event;
    var myKey = e.keyCode;
    
    
    //alt
    if(myKey == 18){
        isAuto = !isAuto;
    }
    
    //isAuto
    if(isAuto){
        e.preventDefault();
        this.value = this.value + autoString[count];// feed in auto script  
       
    }

    
    //enter 
    if(myKey == 13 || autoString[count] == "\n") {    
        var content = this.value;             
        var lastLine = content.substr(content.slice(0, - 1).lastIndexOf("\n")+1);
        //check command
        myCommand(lastLine.trim());
    }  
   
    count++;
    if(count >= autoString.length){ count = 0;}
 
}



var today = new Date();
var platform = window.navigator.platform;
document.getElementById('plText').innerHTML = platform;
document.getElementById('dtText').innerHTML = today;


//


function my_hide(id){
    document.getElementById(id).style.zIndex = -1;  
    console.focus();  
}


function my_show(id){
    document.getElementById(id).style.zIndex = 1;

}


var text = document.getElementById('tool-text'),
    binary = document.getElementById('tool-binary'),
    hex = document.getElementById('tool-hex');

function pad(num, size) {
    return ("00000000" + num).substr(-size);
}




text.addEventListener("keyup", tChange);
binary.addEventListener("keyup", bChange);
hex.addEventListener("keyup", hChange);

function tChange(){
    var input = text.value;
    binary.value = "";
    hex.value = "";
    for (i=0; i < input.length; i++) {
        binary.value += pad(input[i].charCodeAt(0).toString(2), 8) + " ";
        hex.value += input[i].charCodeAt(0).toString(16) + " ";
    }
}

// -1 on binary and hex is to remove tailing space

function bChange(){
    var input = binary.value;
    text.value = "";
    hex.value = "";
    
    var all = input.split(" ");
    
     for (i=0; i < all.length-1; i++) {
        var t =  String.fromCharCode(parseInt(all[i], 2))
        text.value += t;
        hex.value += t.charCodeAt(0).toString(16) + " ";
    }
    
}


function hChange(){
    var input = hex.value;
    text.value = "";
    binary.value = "";
    
    var all = input.split(" ");
    
     for (i=0; i < all.length-1; i++) {
        var t =  String.fromCharCode(parseInt(all[i], 16))
        text.value += t;
        binary.value += pad(t.charCodeAt(0).toString(2),8) + " ";
    }
    
}





my_show("modal");
